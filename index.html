<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WiFi Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .wifi-direct-toggle {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #cbd5e1;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #10b981;
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        .server-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }

        .status-dot.offline {
            background: #ef4444;
        }

        .tabs {
            display: flex;
            background: #f1f5f9;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #64748b;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #4f46e5;
            border-bottom: 3px solid #4f46e5;
        }

        .tab:hover {
            background: #e2e8f0;
        }

        .tab.active:hover {
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #4338ca;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }

        .btn.btn-danger {
            background: #ef4444;
        }

        .btn.btn-danger:hover {
            background: #dc2626;
        }

        .btn.btn-success {
            background: #10b981;
        }

        .btn.btn-success:hover {
            background: #059669;
        }

        .network-list {
            list-style: none;
        }

        .network-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .network-item:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .network-info h3 {
            color: #1e293b;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .network-details {
            color: #64748b;
            font-size: 0.9rem;
        }

        .network-actions {
            display: flex;
            gap: 10px;
        }

        .security-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .security-badge.secure {
            background: #dcfce7;
            color: #166534;
        }

        .security-badge.open {
            background: #fef3c7;
            color: #92400e;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            color: #1e293b;
            font-size: 1.5rem;
        }

        .close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1f2937;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            background: #ef4444;
        }

        .toast.success {
            background: #10b981;
        }

        .wifi-direct-message {
            padding: 40px 30px;
            text-align: center;
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            color: white;
        }

        .wifi-direct-message h2 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .wifi-direct-message p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 12px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .status-bar {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }

            .tab-content {
                padding: 20px;
            }

            .network-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .network-actions {
                width: 100%;
                justify-content: center;
            }

            .modal-content {
                margin: 20px;
                width: calc(100% - 40px);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>WiFi Manager</h1>
            <p>Manage your wireless connections</p>
        </div>

        <div class="status-bar">
            <div class="wifi-direct-toggle">
                <span>WiFi Direct Mode</span>
                <div class="toggle-switch" id="wifi-direct-toggle" onclick="toggleWiFiDirect()">
                    <div class="toggle-slider"></div>
                </div>
                <span id="wifi-direct-status">OFF</span>
            </div>
            <div class="server-status">
                <div class="status-dot" id="status-dot"></div>
                <span id="server-status-text">Online</span>
            </div>
        </div>

        <div id="wifi-direct-message" class="wifi-direct-message" style="display: none;">
            <h2>WiFi Direct Mode Active</h2>
            <p>Device is in WiFi Direct mode. Network scanning and connection features are disabled.</p>
        </div>

        <div id="main-section">
            <div class="tabs">
                <button class="tab active" onclick="showTab('available')">Available Networks</button>
                <button class="tab" onclick="showTab('connected')">Connected</button>
                <button class="tab" onclick="showTab('saved')">Saved Networks</button>
            </div>

            <!-- Available Networks Tab -->
            <div id="available" class="tab-content active">
                <div class="controls">
                    <button class="btn" onclick="refreshNetworks()">
                        <span>üîÑ</span> Scan Networks
                    </button>
                </div>
                <ul class="network-list" id="available-networks">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading networks...</p>
                    </div>
                </ul>
            </div>

            <!-- Connected Network Tab -->
            <div id="connected" class="tab-content">
                <div class="controls">
                    <button class="btn" onclick="refreshConnected()">
                        <span>üîÑ</span> Refresh
                    </button>
                </div>
                <div id="connected-network">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading connection status...</p>
                    </div>
                </div>
            </div>

            <!-- Saved Networks Tab -->
            <div id="saved" class="tab-content">
                <div class="controls">
                    <button class="btn" onclick="refreshSaved()">
                        <span>üîÑ</span> Refresh
                    </button>
                    <button class="btn btn-danger" onclick="forgetAllNetworks()">
                        <span>üóëÔ∏è</span> Forget All
                    </button>
                </div>
                <ul class="network-list" id="saved-networks">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading saved networks...</p>
                    </div>
                </ul>
            </div>
        </div>
    </div>

    <!-- Connect Modal -->
    <div class="modal" id="connect-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Connect to Network</h3>
                <button class="close" onclick="closeModal()">&times;</button>
            </div>
            <form id="connect-form">
                <div class="form-group">
                    <label>Network Name:</label>
                    <input type="text" id="connect-ssid" class="form-control" readonly>
                </div>
                <div class="form-group" id="password-group">
                    <label>Password:</label>
                    <input type="password" id="connect-password" class="form-control" placeholder="Enter network password">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Connect</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script>
        // Global state
        let wifiDirectMode = false;
        let serverOnline = true;
        let currentTab = 'available';

        // Get the base URL for API calls
        function getApiBase() {
            // Get the current pathname and remove any trailing slash
            let path = window.location.pathname.replace(/\/$/, '');
            
            // If we're at the root, return empty string
            if (path === '' || path === '/') {
                return '';
            }
            
            // Otherwise return the path (e.g., '/connect')
            return path;
        }

        // Helper function to make API calls with correct base URL
        async function apiCall(endpoint, options = {}) {
            const baseUrl = getApiBase();
            const url = `${baseUrl}${endpoint}`;
            return fetch(url, options);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkServerStatus();
            fetchWiFiDirectStatus();
            showTab('available');
            
            // Check server status periodically
            setInterval(checkServerStatus, 5000);
        });

        // Server status check
        async function checkServerStatus() {
            try {
                const response = await apiCall('/health', { 
                    method: 'GET',
                    signal: AbortSignal.timeout(3000)
                });
                
                if (response.ok) {
                    if (!serverOnline) {
                        serverOnline = true;
                        updateServerStatus(true);
                        showToast('Server is back online', 'success');
                    }
                } else {
                    throw new Error('Server unavailable');
                }
            } catch (error) {
                if (serverOnline) {
                    serverOnline = false;
                    updateServerStatus(false);
                    showToast('Server is offline', 'error');
                }
            }
        }

        // Update server status indicator
        function updateServerStatus(online) {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('server-status-text');
            
            if (online) {
                dot.classList.remove('offline');
                text.textContent = 'Online';
            } else {
                dot.classList.add('offline');
                text.textContent = 'Offline';
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Tab management
        function showTab(tabName) {
            if (wifiDirectMode) return; // Don't change tabs in WiFi Direct mode
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            currentTab = tabName;
            
            // Load content based on tab
            switch(tabName) {
                case 'available':
                    refreshNetworks();
                    break;
                case 'connected':
                    refreshConnected();
                    break;
                case 'saved':
                    refreshSaved();
                    break;
            }
        }

        // WiFi Direct toggle
        async function toggleWiFiDirect() {
            if (!serverOnline) {
                showToast('Server is offline', 'error');
                return;
            }

            try {
                const newValue = !wifiDirectMode;
                showToast('Toggling WiFi Direct...', 'success');
                
                const response = await apiCall('/set-wifi-direct', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ value: newValue.toString() })
                });
                
                if (!response.ok) throw new Error('Failed to toggle WiFi Direct');
                
                const data = await response.json();
                wifiDirectMode = data.value;
                updateWiFiDirectUI(wifiDirectMode);
                
                showToast(`WiFi Direct ${wifiDirectMode ? 'enabled' : 'disabled'}`, 'success');
                
                if (wifiDirectMode) {
                    showToast('Server restarting...', 'success');
                    setTimeout(() => {
                        serverOnline = false;
                        updateServerStatus(false);
                        
                        // Wait for server to come back
                        const checkRestart = () => {
                            checkServerStatus().then(() => {
                                if (serverOnline) {
                                    showToast('Server restarted successfully', 'success');
                                } else {
                                    setTimeout(checkRestart, 2000);
                                }
                            });
                        };
                        setTimeout(checkRestart, 3000);
                    }, 1000);
                }
                
            } catch (error) {
                console.error('Error toggling WiFi Direct:', error);
                showToast('Error toggling WiFi Direct', 'error');
            }
        }

        // Fetch WiFi Direct status
        async function fetchWiFiDirectStatus() {
            try {
                const response = await apiCall('/get-wifi-direct');
                if (!response.ok) throw new Error('Failed to fetch status');
                
                const data = await response.json();
                wifiDirectMode = data.value === true;
                updateWiFiDirectUI(wifiDirectMode);
            } catch (error) {
                console.error('Error fetching WiFi Direct status:', error);
                showToast('Error loading WiFi Direct status', 'error');
            }
        }

        // Update WiFi Direct UI
        function updateWiFiDirectUI(isActive) {
            const toggle = document.getElementById('wifi-direct-toggle');
            const status = document.getElementById('wifi-direct-status');
            const message = document.getElementById('wifi-direct-message');
            const mainSection = document.getElementById('main-section');
            
            if (isActive) {
                toggle.classList.add('active');
                status.textContent = 'ON';
                message.style.display = 'block';
                mainSection.style.display = 'none';
            } else {
                toggle.classList.remove('active');
                status.textContent = 'OFF';
                message.style.display = 'none';
                mainSection.style.display = 'block';
            }
        }

        // Network scanning
        async function refreshNetworks() {
            const container = document.getElementById('available-networks');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Scanning networks...</p></div>';

            try {
                const response = await apiCall('/list-networks?use_cache=false');
                if (!response.ok) throw new Error('Failed to scan networks');
                
                const data = await response.json();
                renderAvailableNetworks(data.networks || []);
            } catch (error) {
                console.error('Error scanning networks:', error);
                container.innerHTML = '<div class="empty-state"><p>Error loading networks. Please try again.</p></div>';
                showToast('Error scanning networks', 'error');
            }
        }

        // Render available networks
        function renderAvailableNetworks(networks) {
            const container = document.getElementById('available-networks');
            
            if (networks.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No networks found. Try scanning again.</p></div>';
                return;
            }

            container.innerHTML = networks.map(network => `
                <li class="network-item" onclick="showConnectModal('${escapeHtml(network.ssid)}', '${escapeHtml(network.security)}')">
                    <div class="network-info">
                        <h3>üì∂ ${escapeHtml(network.ssid)}</h3>
                        <div class="network-details">
                            Security: ${escapeHtml(network.security)}
                            ${network.signal_strength ? ` ‚Ä¢ Signal: ${network.signal_strength}%` : ''}
                            <span class="security-badge ${network.security === 'open' ? 'open' : 'secure'}">
                                ${network.security === 'open' ? 'üîì Open' : 'üîí Secured'}
                            </span>
                        </div>
                    </div>
                </li>
            `).join('');
        }

        // Connected network status
        async function refreshConnected() {
            const container = document.getElementById('connected-network');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading connection status...</p></div>';

            try {
                const response = await apiCall('/list-connected');
                if (!response.ok) throw new Error('Failed to get connection status');
                
                const data = await response.json();
                renderConnectedNetwork(data.connected);
            } catch (error) {
                console.error('Error getting connection status:', error);
                container.innerHTML = '<div class="empty-state"><p>Error loading connection status</p></div>';
                showToast('Error loading connection status', 'error');
            }
        }

        // Render connected network
        function renderConnectedNetwork(network) {
            const container = document.getElementById('connected-network');
            
            if (!network) {
                container.innerHTML = '<div class="empty-state"><p>üìµ No network connected</p></div>';
                return;
            }

            container.innerHTML = `
                <div class="network-item">
                    <div class="network-info">
                        <h3>üì∂ ${escapeHtml(network.ssid)} <span style="color: #10b981;">‚úì Connected</span></h3>
                        <div class="network-details">
                            Interface: ${escapeHtml(network.interface)}<br>
                            Security: ${escapeHtml(network.security)}
                        </div>
                    </div>
                </div>
            `;
        }

        // Saved networks
        async function refreshSaved() {
            const container = document.getElementById('saved-networks');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading saved networks...</p></div>';

            try {
                const response = await apiCall('/list-saved');
                if (!response.ok) throw new Error('Failed to get saved networks');
                
                const data = await response.json();
                renderSavedNetworks(data.saved_networks || []);
            } catch (error) {
                console.error('Error getting saved networks:', error);
                container.innerHTML = '<div class="empty-state"><p>Error loading saved networks</p></div>';
                showToast('Error loading saved networks', 'error');
            }
        }

        // Render saved networks
        function renderSavedNetworks(networks) {
            const container = document.getElementById('saved-networks');
            
            if (networks.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>üìë No saved networks found</p></div>';
                return;
            }

            container.innerHTML = networks.map(network => `
                <li class="network-item">
                    <div class="network-info">
                        <h3>üìë ${escapeHtml(network.ssid)}</h3>
                        <div class="network-details">Security: ${escapeHtml(network.security)}</div>
                    </div>
                    <div class="network-actions">
                        <button class="btn btn-success" onclick="event.stopPropagation(); connectToSaved('${escapeHtml(network.ssid)}')">
                            Connect
                        </button>
                        <button class="btn btn-danger" onclick="event.stopPropagation(); forgetNetwork('${escapeHtml(network.ssid)}')">
                            Forget
                        </button>
                    </div>
                </li>
            `).join('');
        }

        // Connection modal
        function showConnectModal(ssid, security) {
            document.getElementById('connect-ssid').value = ssid;
            document.getElementById('connect-password').value = '';
            
            const passwordGroup = document.getElementById('password-group');
            if (security === 'open' || security === 'none') {
                passwordGroup.style.display = 'none';
            } else {
                passwordGroup.style.display = 'block';
            }
            
            document.getElementById('connect-modal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('connect-modal').style.display = 'none';
        }

        // Connect to network
        document.getElementById('connect-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const ssid = document.getElementById('connect-ssid').value;
            const password = document.getElementById('connect-password').value;
            
            closeModal();
            
            try {
                const response = await apiCall('/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ssid: ssid,
                        passphrase: password || undefined
                    })
                });
                
                if (!response.ok) throw new Error('Connection failed');
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(`Connected to ${ssid}`, 'success');
                    setTimeout(() => refreshConnected(), 2000);
                } else {
                    showToast(`Failed to connect to ${ssid}`, 'error');
                }
            } catch (error) {
                console.error('Error connecting:', error);
                showToast(`Error connecting to ${ssid}`, 'error');
            }
        });

        // Connect to saved network
        async function connectToSaved(ssid) {
            try {
                const response = await apiCall('/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ssid: ssid })
                });
                
                if (!response.ok) throw new Error('Connection failed');
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(`Connected to ${ssid}`, 'success');
                    setTimeout(() => refreshConnected(), 2000);
                } else {
                    showToast(`Failed to connect to ${ssid}`, 'error');
                }
            } catch (error) {
                console.error('Error connecting to saved network:', error);
                showToast(`Error connecting to ${ssid}`, 'error');
            }
        }

        // Forget network
        async function forgetNetwork(ssid) {
            if (!confirm(`Are you sure you want to forget "${ssid}"?`)) return;
            
            try {
                const response = await apiCall('/forget', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ network_name: ssid })
                });
                
                if (!response.ok) throw new Error('Failed to forget network');
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(`Forgot network "${ssid}"`, 'success');
                    refreshSaved();
                } else {
                    showToast(`Failed to forget "${ssid}"`, 'error');
                }
            } catch (error) {
                console.error('Error forgetting network:', error);
                showToast(`Error forgetting "${ssid}"`, 'error');
            }
        }

        // Forget all networks
        async function forgetAllNetworks() {
            if (!confirm('Are you sure you want to forget ALL saved networks? This cannot be undone.')) return;
            
            try {
                const response = await apiCall('/forget-all', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                if (!response.ok) throw new Error('Failed to forget all networks');
                
                const data = await response.json();
                
                if (data.success) {
                    showToast('All networks forgotten', 'success');
                    refreshSaved();
                } else {
                    showToast('Failed to forget all networks', 'error');
                }
            } catch (error) {
                console.error('Error forgetting all networks:', error);
                showToast('Error forgetting all networks', 'error');
            }
        }

        // Utility function to escape HTML
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Close modal when clicking outside
        document.getElementById('connect-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
